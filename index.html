<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>JOZETHCPM1 — Neon Hub Mejorado</title>
<style>
  /* Estilo resumido y limpio para foco funcional */
  body {
    background: #040514;
    color: #e6f7ff;
    font-family: Arial, sans-serif;
    margin: 0; padding: 20px;
  }
  .container {
    max-width: 900px;
    margin: auto;
    background: rgba(255,255,255,0.05);
    border-radius: 12px;
    padding: 20px;
  }
  input, select, textarea, button {
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    margin-bottom: 12px;
    border-radius: 6px;
    border: none;
    font-size: 16px;
  }
  button {
    cursor: pointer;
    background: #00f0ff;
    color: black;
    font-weight: bold;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background: #00b0cc;
  }
  .hidden {
    display: none;
  }
  .header {
    text-align: center;
    margin-bottom: 20px;
  }
  .links-list, .comments-list {
    margin-top: 10px;
  }
  .item {
    background: rgba(0,255,255,0.1);
    margin-bottom: 10px;
    padding: 10px;
    border-radius: 8px;
    word-break: break-word;
  }
  .watermark {
    position: fixed;
    bottom: 12px;
    right: 12px;
    color: #ffd700;
    font-weight: bold;
    font-size: 14px;
    user-select:none;
  }
</style>
</head>
<body>
  <div class="watermark">JOZETHCPM1</div>
  <div class="container">
    <div class="header">
      <h1>JOZETHCPM1 — Neon Hub Mejorado</h1>
      <p>Inicia sesión, comparte enlaces APK y scripts, y comenta seguro.</p>
    </div>

    <!-- Login -->
    <div id="login-section">
      <label for="login-user">Usuario</label>
      <input type="text" id="login-user" placeholder="Usuario" autocomplete="username" />
      <label for="login-pass">Contraseña</label>
      <input type="password" id="login-pass" placeholder="Contraseña" autocomplete="current-password" />
      <button id="login-btn">Entrar</button>
    </div>

    <!-- Panel tras login -->
    <div id="panel" class="hidden">
      <p>Bienvenido <strong id="current-user"></strong>! <button id="logout-btn" style="width:auto; padding:6px 12px; margin-left:10px; background:#ff0044; color:white;">Salir</button></p>

      <!-- Subir enlaces -->
      <h2>Subir enlace</h2>
      <label for="link-type">Tipo</label>
      <select id="link-type">
        <option value="apk">APK</option>
        <option value="gg">Script (GG)</option>
      </select>
      <label for="link-url">Enlace (URL)</label>
      <input type="text" id="link-url" placeholder="https://..." />
      <label for="link-desc">Descripción</label>
      <input type="text" id="link-desc" placeholder="Breve descripción" />
      <button id="add-link-btn">Agregar enlace</button>

      <div class="links-list" aria-live="polite" id="links-list">
        <!-- Enlaces agregados aquí -->
      </div>

      <!-- Comentarios -->
      <h2>Comentarios</h2>
      <label for="comment-name">Nombre</label>
      <input type="text" id="comment-name" placeholder="Tu nombre" />
      <label for="comment-text">Comentario</label>
      <textarea id="comment-text" placeholder="Comparte tu opinión..."></textarea>
      <button id="post-comment-btn">Publicar comentario</button>

      <div class="comments-list" aria-live="polite" id="comments-list">
        <!-- Comentarios aquí -->
      </div>
    </div>
  </div>

<script>
  // Constantes admin
  const ADMIN_USER = "JOZETHCPM1";
  const ADMIN_PASS = "123456";

  // Elementos DOM
  const loginSection = document.getElementById('login-section');
  const panel = document.getElementById('panel');
  const loginBtn = document.getElementById('login-btn');
  const logoutBtn = document.getElementById('logout-btn');
  const currentUserSpan = document.getElementById('current-user');

  const loginUserInput = document.getElementById('login-user');
  const loginPassInput = document.getElementById('login-pass');

  const linkType = document.getElementById('link-type');
  const linkUrl = document.getElementById('link-url');
  const linkDesc = document.getElementById('link-desc');
  const addLinkBtn = document.getElementById('add-link-btn');
  const linksList = document.getElementById('links-list');

  const commentName = document.getElementById('comment-name');
  const commentText = document.getElementById('comment-text');
  const postCommentBtn = document.getElementById('post-comment-btn');
  const commentsList = document.getElementById('comments-list');

  // Estado
  let state = {
    loggedUser: null,
    links: [],
    comments: []
  };

  // Guardar y cargar estado de localStorage
  function saveState(){
    localStorage.setItem('jozethcpm1_state', JSON.stringify(state));
  }
  function loadState(){
    const saved = localStorage.getItem('jozethcpm1_state');
    if(saved){
      try {
        state = JSON.parse(saved);
      } catch(e){
        console.warn("Error cargando estado:", e);
      }
    }
  }

  // Render enlaces
  function renderLinks(){
    linksList.innerHTML = "";
    if(state.links.length === 0){
      linksList.textContent = "No hay enlaces aún.";
      return;
    }
    state.links.forEach((l,i) => {
      const div = document.createElement('div');
      div.className = "item";
      div.innerHTML = `<strong>[${l.type.toUpperCase()}]</strong> <a href="${l.url}" target="_blank" rel="noopener noreferrer">${l.url}</a><br><em>${l.desc || ''}</em>`;
      // Si es admin, agregar botón borrar
      if(state.loggedUser === ADMIN_USER){
        const btnDel = document.createElement('button');
        btnDel.textContent = "Eliminar";
        btnDel.style = "margin-left:10px; background:#ff0044; color:white; padding:2px 8px; font-size:12px; border:none; border-radius:5px; cursor:pointer;";
        btnDel.onclick = () => {
          if(confirm("Eliminar este enlace?")) {
            state.links.splice(i,1);
            saveState();
            renderLinks();
          }
        };
        div.appendChild(btnDel);
      }
      linksList.appendChild(div);
    });
  }

  // Render comentarios
  function renderComments(){
    commentsList.innerHTML = "";
    if(state.comments.length === 0){
      commentsList.textContent = "No hay comentarios aún.";
      return;
    }
    state.comments.forEach((c,i) => {
      const div = document.createElement('div');
      div.className = "item";
      div.innerHTML = `<strong>${escapeHtml(c.name)}</strong>: ${escapeHtml(c.text)}`;
      if(state.loggedUser === ADMIN_USER){
        const btnDel = document.createElement('button');
        btnDel.textContent = "Eliminar";
        btnDel.style = "margin-left:10px; background:#ff0044; color:white; padding:2px 8px; font-size:12px; border:none; border-radius:5px; cursor:pointer;";
        btnDel.onclick = () => {
          if(confirm("Eliminar este comentario?")) {
            state.comments.splice(i,1);
            saveState();
            renderComments();
          }
        };
        div.appendChild(btnDel);
      }
      commentsList.appendChild(div);
    });
  }

  // Escape para evitar HTML malicioso
  function escapeHtml(text){
    return text.replace(/[&<>"']/g, function(m){
      return {'&':'&amp;', '<':'&lt;', '>':'&gt;', '"':'&quot;', "'":'&#39;'}[m];
    });
  }

  // Validar link no sospechoso
  function isLinkSuspicious(url){
    const suspiciousPatterns = [
      /porn/i,
      /sex/i,
      /xxx/i,
      /bit\.ly/i,
      /tinyurl\.com/i,
      /some-random-badsite\.com/i
      // Agrega más patrones si quieres
    ];
    return suspiciousPatterns.some(rx => rx.test(url));
  }

  // Manejar login
  loginBtn.onclick = () => {
    const user = loginUserInput.value.trim();
    const pass = loginPassInput.value;

    if(user === "" || pass === ""){
      alert("Por favor completa usuario y contraseña.");
      return;
    }

    // Solo admin puede iniciar sesión
    if(user !== ADMIN_USER){
      alert("Usuario inválido.");
      return;
    }
    if(pass !== ADMIN_PASS){
      alert("Contraseña incorrecta.");
      return;
    }

    state.loggedUser = user;
    saveState();
    updateUIAfterLogin();
  };

  // Manejar logout
  logoutBtn.onclick = () => {
    state.loggedUser = null;
    saveState();
    updateUIAfterLogout();
  };

  // Actualizar UI tras login
  function updateUIAfterLogin(){
    loginSection.classList.add('hidden');
    panel.classList.remove('hidden');
    currentUserSpan.textContent = state.loggedUser;
    renderLinks();
    renderComments();
  }
  // UI tras logout
  function updateUIAfterLogout(){
    loginSection.classList.remove('hidden');
    panel.classList.add('hidden');
    loginUserInput.value = "";
    loginPassInput.value = "";
    linksList.innerHTML = "";
    commentsList.innerHTML = "";
  }

  // Agregar enlace
  addLinkBtn.onclick = () => {
    if(!state.loggedUser){
      alert("Debes iniciar sesión para agregar enlaces.");
      return;
    }
    const type = linkType.value;
    const url = linkUrl.value.trim();
    const desc = linkDesc.value.trim();

    if(url === ""){
      alert("Ingresa un enlace válido.");
      return;
    }
    try {
      new URL(url);
    } catch(e){
      alert("El enlace no es una URL válida.");
      return;
    }

    if(isLinkSuspicious(url)){
      alert("El enlace contiene palabras sospechosas y no puede ser agregado.");
      return;
    }

    // No permitir que otro usuario cree con nombre admin
    if(state.loggedUser !== ADMIN_USER && (desc.includes(ADMIN_USER) || url.includes(ADMIN_USER))){
      alert("No está permitido usar nombre admin en enlaces.");
      return;
    }

    state.links.push({type, url, desc});
    saveState();
    renderLinks();

    // Limpiar inputs
    linkUrl.value = "";
    linkDesc.value = "";
  };

  // Agregar comentario
  postCommentBtn.onclick = () => {
    if(!state.loggedUser){
      alert("Debes iniciar sesión para comentar.");
      return;
    }
    const name = commentName.value.trim();
    const text = commentText.value.trim();

    if(name === "" || text === ""){
      alert("Nombre y comentario son obligatorios.");
      return;
    }

    if(isLinkSuspicious(text)){
      alert("El comentario contiene palabras o links sospechosos y no puede ser publicado.");
      return;
    }

    state.comments.push({name, text});
    saveState();
    renderComments();

    commentName.value = "";
    commentText.value = "";
  };

  // Al cargar página
  window.onload = () => {
    loadState();
    if(state.loggedUser === ADMIN_USER){
      updateUIAfterLogin();
    } else {
      updateUIAfterLogout();
    }
  };
</script>
</body>
</html>
